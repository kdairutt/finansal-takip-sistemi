<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Para Uzmanı - Ana Ekran</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/dashboard.css">
</head>
<body>

    <!-- Üst Menü (giriş sonrası) -->
    <div class="top-bar">
        <div class="top-bar-inner">
            <div class="logo">
                <a href="dashboard.html">Para Uzmanı</a>
            </div>

            <ul class="top-menu">
                <li><a href="dashboard.html" class="active">Ana Ekran</a></li>
                <li><a href="profil.html">Profil</a></li>
                <li><a href="varliklar.html">Varlıklarım</a></li>
                <li><a href="borclar.html">Borçlarım</a></li>
                <li><a href="gelirler.html">Gelirlerim</a></li>
                <li><a href="giderler.html">Giderlerim</a></li>
                <li><a href="faiz.html">Faiz Hesapla</a></li>
                <li><a href="doviz.html">Döviz &amp; Kıymetli Maden</a></li>
                <li><a href="#" class="disabled-link">Tahmini Gelir–Gider</a></li>
                <li><a href="index.html" class="logout-btn" onclick="cikisYap()">Çıkış Yap</a></li>
            </ul>
        </div>
    </div>

    <!-- Ana İçerik -->
    <div class="container">

        <div class="dashboard-header">
            <h1 id="hosgeldinMesaji">Hoş Geldin!</h1>
            <p>
                Aşağıda genel finansal durumunun özeti yer alıyor. Detaylı kayıt ekleme ve düzenleme için
                üst menüdeki ilgili sayfaları kullanabilirsin.
            </p>
        </div>

        <!-- Özet kartlar: varlık / borç / net -->
        <div class="card-grid">
            <div class="card">
                <div class="card-title">Toplam Varlıklar</div>
                <div class="card-value" id="card-total-assets">0 TL</div>
                <div class="card-extra">
                    Varlıklarım sayfasında eklediğin:
                    <ul>
                        <li>Banka hesapları ve nakit</li>
                        <li>Yatırım hesapları</li>
                        <li>Diğer finansal varlıklar</li>
                    </ul>
                </div>
            </div>
            <div class="card">
                <div class="card-title">Toplam Borçlar</div>
                <div class="card-value" id="card-total-debts">0 TL</div>
                <div class="card-extra">
                    Borçlarım sayfasında eklediğin:
                    <ul>
                        <li>Kredi ve kredi kartı borçları</li>
                        <li>Taksitli alışverişler</li>
                        <li>Diğer borç ve yükümlülükler</li>
                    </ul>
                </div>
            </div>
            <div class="card">
                <div class="card-title">Net Varlık</div>
                <div class="card-value card-highlight" id="card-net-worth">0 TL</div>
                <div class="card-extra">
                    <strong>Hesaplama:</strong> Toplam varlıklar - toplam borçlar.  
                    Bu değer, genel finansal gücünü özetler.
                </div>
            </div>
        </div>

        <!-- Özet kartlar: aylık gelir / gider / net -->
        <div class="card-grid">
            <div class="card">
                <div class="card-title">Aylık Gelir</div>
                <div class="card-value" id="card-monthly-income">0 TL</div>
                <div class="card-extra">
                    Gelirlerim sayfasında yer alan:
                    <ul>
                        <li>Maaş ve düzenli ödemeler</li>
                        <li>Burs ve ek gelirler</li>
                        <li>Diğer aylık kazançlar</li>
                    </ul>
                </div>
            </div>
            <div class="card">
                <div class="card-title">Aylık Gider</div>
                <div class="card-value" id="card-monthly-expense">0 TL</div>
                <div class="card-extra">
                    Giderlerim sayfasında yer alan:
                    <ul>
                        <li>Fatura ve kira ödemeleri</li>
                        <li>Market, ulaşım ve günlük harcamalar</li>
                        <li>Eğlence ve diğer giderler</li>
                    </ul>
                </div>
            </div>
            <div class="card">
                <div class="card-title">Aylık Net Durum</div>
                <div class="card-value card-highlight" id="card-monthly-net">0 TL</div>
                <div class="card-extra">
                    <strong>Hesaplama:</strong> Aylık gelir - aylık gider.  
                    Pozitif olması, her ay kenara para ayırabildiğin anlamına gelir.
                </div>
            </div>
        </div>

    </div>


    <!-- Finansal Durum Çubuğu -->
    <div class="fin-panel">
        <h2>Genel Finansal Durumun</h2>
        <p>
            Net varlık ve aylık net durumuna göre hesaplanan basit bir gösterge.
            Borç ve giderlerin arttıkça çubuk sola doğru kısalır ve rengi kızarır.
        </p>

        <div class="fin-bar-wrapper">
            <div class="fin-bar">
                <div class="fin-bar-inner" id="fin-bar-inner"></div>
            </div>
            <div class="fin-bar-text" id="fin-bar-text">
                Henüz hesaplanmadı.
            </div>
            <div class="fin-bar-note" id="fin-bar-note">
                Varlıklar, borçlar ve aylık net durumuna göre otomatik güncellenir.
            </div>
        </div>
    </div>

    <!-- Basit JavaScript -->
    <script>
        // Çıkış Yap
        function cikisYap() {
            var cevap = confirm("Çıkış yapmak istediğinize emin misiniz?");
            if (cevap == true) {
                window.location = "index.html";
            }
        }

        // Sayıyı "X.XXX TL" formatında göstermek için yardımcı fonksiyon
        function formatTL(value) {
            if (isNaN(value)) {
                return "0 TL";
            }
            return value.toLocaleString("tr-TR") + " TL";
        }

        // Dashboard verilerini localStorage'tan yükle
        function dashboardVerileriniYukle() {
            // Varlık / borç özetleri
            var assetsText = localStorage.getItem("toplamVarlik");
            var debtsText  = localStorage.getItem("toplamBorc");

            var assets = Number(assetsText);
            var debts  = Number(debtsText);

            var assetsElement = document.getElementById("card-total-assets");
            var debtsElement  = document.getElementById("card-total-debts");
            var netElement    = document.getElementById("card-net-worth");

            if (!isNaN(assets)) {
                assetsElement.textContent = formatTL(assets);
            }
            if (!isNaN(debts)) {
                debtsElement.textContent = formatTL(debts);
            }

            if (!isNaN(assets) && !isNaN(debts)) {
                var net = assets - debts;
                netElement.textContent = formatTL(net);

                if (net < 0) {
                    netElement.classList.add("card-negative");
                    netElement.classList.remove("card-highlight");
                } else {
                    netElement.classList.add("card-highlight");
                    netElement.classList.remove("card-negative");
                }
            }

            // Aylık gelir / gider özetleri (Gelirlerim / Giderlerim sayfasından set edilecek)
            var aylikGelirText = localStorage.getItem("aylikGelir");
            var aylikGiderText = localStorage.getItem("aylikGider");

            var aylikGelir = Number(aylikGelirText);
            var aylikGider = Number(aylikGiderText);
            var aylikNet   = aylikGelir - aylikGider;

            var incomeElement  = document.getElementById("card-monthly-income");
            var expenseElement = document.getElementById("card-monthly-expense");
            var netMonthlyEl   = document.getElementById("card-monthly-net");
            
            if (!isNaN(aylikGelir)) {
                incomeElement.textContent = formatTL(aylikGelir);
            }
            if (!isNaN(aylikGider)) {
                expenseElement.textContent = formatTL(aylikGider);
            }
            if (!isNaN(aylikGelir) && !isNaN(aylikGider)) {
                netMonthlyEl.textContent = formatTL(aylikNet);

                if (aylikNet < 0) {
                    netMonthlyEl.classList.add("card-negative");
                    netMonthlyEl.classList.remove("card-highlight");
                } else {
                    netMonthlyEl.classList.add("card-highlight");
                    netMonthlyEl.classList.remove("card-negative");
                }
            }
        }

    // Genel finansal durum çubuğunu güncelle
    function finansalDurumBariniGuncelle() {
        // Varlık / borç
        var assets = Number(localStorage.getItem("toplamVarlik") || 0);
        var debts  = Number(localStorage.getItem("toplamBorc") || 0);

        // Aylık gelir / gider
        var aylikGelir = Number(localStorage.getItem("aylikGelir") || 0);
        var aylikGider = Number(localStorage.getItem("aylikGider") || 0);

        var netVarlik = assets - debts;           // uzun vadeli güç
        var aylikNet  = aylikGelir - aylikGider;  // o ayın performansı

        // Toplam finansal "puan"
        var toplamDurum = netVarlik + aylikNet;

        // --- NORMALİZE ETME MANTIĞI ---
        // Burada bir aralık belirliyoruz:
        // -200.000 TL  -> %0 (bar kısacık, kıpkırmızı)
        //  200.000 TL  -> %100 (bar full, yemyeşil)
        var minDeger = -200000;
        var maxDeger =  200000;
        var oran = (toplamDurum - minDeger) / (maxDeger - minDeger);

        if (oran < 0) oran = 0;
        if (oran > 1) oran = 1;

        var yuzde = Math.round(oran * 100);

        var bar   = document.getElementById("fin-bar-inner");
        var text  = document.getElementById("fin-bar-text");
        var note  = document.getElementById("fin-bar-note");

        // Çubuğun genişliği: borç/gider arttıkça toplamDurum düşer, oran küçülür, width azalır
        bar.style.width = yuzde + "%";

        // Renk: sola yaklaştıkça kırmızı, ortalarda turuncu, sağa yaklaştıkça yeşil
        var renk;
        var seviyeMetni;

        if (yuzde <= 30) {
            renk = "#e53935";          // kırmızı
            seviyeMetni = "Riskli";
        } else if (yuzde <= 60) {
            renk = "#fb8c00";          // turuncu
            seviyeMetni = "Dikkatli";
        } else {
            renk = "#43a047";          // yeşil
            seviyeMetni = "Güvende";
        }

        bar.style.backgroundColor = renk;

        text.textContent = "Genel finansal durum: " + seviyeMetni + " (" + yuzde + "%)";
        note.textContent = 
            "Net varlık: " + netVarlik + " TL, aylık net: " + aylikNet + 
            " TL → Toplam: " + toplamDurum + " TL";
    }

        // Sayfa açıldığında verileri yükle
        window.onload = function () {
        dashboardVerileriniYukle();      // zaten vardı
        finansalDurumBariniGuncelle();   // senin eklemen gereken satır
        };

        // Kullanıcı adını yükle
        var ad = localStorage.getItem("kullaniciAdi");
        if (ad) {
            document.getElementById("hosgeldinMesaji").textContent = "Hoş Geldin, " + ad + "!";
        }
    </script>

</body>
</html>